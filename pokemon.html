<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokemon overview</title>
  </head>
  <body>
    <div class="container">
      <h1>Pokemon Overview</h1>

      <div class="tabs">
        <span onclick="changeTab('all')" id="tab-all">All</span>
        <span onclick="changeTab('saved')" id="tab-saved">my favorite</span>
      </div>

      <button id="myBtn">create</button>

      <form>
        <div class="filters">
          <span>select type</span>
          <div id="filter-type"></div>
          <button type="submit">Filter</button>
        </div>
      </form>

      <section id="pokmans"></section>
    </div>

    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="create-name-section">
          <label>Name:</label>
          <input id="create-name" />
        </div>
        <div id="create-type-section"></div>
        <div id="modal-btn">
          <button onclick="createPokman(0)" class="save">save</button>
        </div>
      </div>
    </div>

    <script>
      const url = "https://pokeapi.co/api/v2/pokemon?offset=0&limit=50";
      const url_types = "https://pokeapi.co/api/v2/type/";
      let pokmansContainer = document.getElementById("pokmans");
      let pokmans = [];
      let types = [];
      const urlParams = new URLSearchParams(window.location.search);
      const urlFilterType = urlParams.get("type");

      if (urlFilterType) {
        getFilterData(urlFilterType);
      } else {
        if (JSON.parse(localStorage.getItem("pokmans")))
          getAllDataFromLocal(JSON.parse(localStorage.getItem("pokmans")));
        else getAllData();
      }
      gettypes();
      ModalForCreatePokman();

      async function getAllData() {
        let res = await fetch(url).then((response) => response.json());
        let fetchresult = res.results;
        let htmlCards = "";
        let len = 50;
        if (fetchresult.length < 50) {
          len = fetchresult.length;
        }
        for (let i = 0; i <= len - 1; i++) {
          let item = fetchresult[i];
          let newdata = await fetch(item.url).then((response) =>
            response.json()
          );

          let data = {
            id: newdata.id,
            image: newdata.sprites.other.home.front_default,
            name: newdata.name,
            url: item.url,
            type: newdata.types[0].type,
          };

          pokmans.push(data);
          localStorage.setItem("pokmans", JSON.stringify(pokmans));
          let card = getCard(data);
          htmlCards += card;
        }
        pokmansContainer.innerHTML = htmlCards;
        setBackgroundColor(pokmans);
      }

      async function  getAllDataFromLocal(fetchresult){
                        pokmans=[];
                        let htmlCards = "";
                        let len=50;
                        if(fetchresult.length<50){
                            len = fetchresult.length;
                        }
                       for(let i=0;i<=len-1;i++){
                        let data = fetchresult[i];
                        pokmans.push(data);
                        let card = getCard(data);
                        htmlCards +=card;
                        }

                        pokmansContainer.innerHTML=(htmlCards);
                        setBackgroundColor(fetchresult);
                       
                    }
    </script>
  </body>
</html>
